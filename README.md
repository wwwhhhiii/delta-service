### Описание структуры приложения

```
delta-service
├── src
│   └── delta_service
│       ├── blueprints            - API эндпоинты приложения.
│       │   └── delta.py          - Реализация логики API запросов к таблице deltas.
│       ├── db                    - Модуль ответственный за взаимодействие с БД.
│       │   ├── crud              - Реализация непосредственных CRUD операций с БД.
│       │   └── events.py         - Реализация общих событий взаимодействия с БД.
│       ├── models                - Реализация моделей приложения.
│       │   ├── api               - Реализация API схем.
│       │   └── db                - Реализация сущностей БД.
│       │   ├── entities.py  - Репрезентация сущностей БД в виде Python объектов. 
│       │        └── tables.py    - Описание таблиц БД при помощи SQLAlchemy.
│       ├── settings              - Модуль с настройками приложения. 
│       ├── util                  - Модуль вспомогательных утилит.
│       │    ├── convertors.py    - Реализация конвертации структур данных.
│       │    ├── parsers.py       - Реализация пареров. (Здесь логика парсинга Excel файлов)
│       │    └── tables_processing.py - Реализация обработки табличных данных. (Здесь логика применения DeltaLag через pandas)
│       ├── xlsx_file_handler.py  - Реализация логики работы с файловой системой и Excel файлами.
│       └── app.py                - Точка входа для запуска приложения.
└── alembic                       - Модуль ответственный за миграции БД.
    └── versions                  - Модуль с ревизиями. (Здесь создается БД представление с полем DeltaLag)
```
  

### Переменные окружения

  

`FLASK_APP_NAME` - Имя сервиса Flask.

`XLSX_INPUT_DIR` - Директория ожидания `.xlsx` файлов для сервиса.

`XLSX_DIR_CHECK_INTERVAL_SEC` - Интревал (сек.) проверки директории с `.xlsx` файлами.

  

Реквизиты для подключения к СУБД PostgreSQL. (Используются приложением, при подключении к БД, alembic-ом при миграциях и файлом `docker-compose.yml` при поднятии контейнера с PostgreSQL.)

`DB_USER` - Пользователь.

`DB_PASSWORD` - Пароль.

`DB_NAME` - Имя базы данных.

  

### Запуск приложения

  

Установка зависимостей:

  

```

cd delta-service/

python3 -m venv env

source ./env/bin/activate

pip install -r ./requirements.txt

```

  

Запуск:

 *Перед запуском необходимо установить переменные окружения перечисленные выше.*

```

cd delta-service/src/delta_service/

python3 app.py

```

  

### Миграции БД

  

```

cd delta-service/

```

  

Автогенерация миграций из метаданных SQLAlchemy:

```

alembic revision --autogenerate -m "<message>"

```

  

Миграция на актуальную ревизию:

```

alembic upgrade head

```

  

Миграция на ревизию вперед:

```

alembic upgrade +1

```

  

Миграция на ревизию назад:

```

alembic upgrade -1

```
